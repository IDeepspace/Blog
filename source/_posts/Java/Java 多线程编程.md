---
title: Java 中多线程编程
author: Deepspace
tags:
  - Java
  - concurrency
categories: Java
date: 2017-06-29
urlname: java-concurrency-program
---



在学习 `Java` 中的多线程编程之前，我们需要先了解一下**进程和线程**的概念。



### 一、多线程是什么？

#### 1、进程

**进程是一个应用程序的一次执行过程 —— 从创建、运行到消亡的过程。**所以，一个进程就是一个运行中的程序，它在计算机中按照一个接着一个的指令地执行着。

**每个进程都有自己独立的地址空间**（内存空间），比如用户打开一个软件，这就相当于启动了一个进程，操作系统就会为该进程分配独立的地址空间。当用户打开另一个软件，相当于又启动了一个进程，操作系统将为新的进程分配新的独立的地址空间。目前的操作系统基本上都支持多进程。

除了内存空间外，每个进程还占有其它系统资源，如 `CPU` 、文件资源、输入和输出设备的使用权、网络等等。

> 注意，并不是说一个应用程序只能有一个进程，一个应用程序是可以开启多个进程的，比如 `Chrome`。
>
> `Chrome` 会拥有一个主进程，其他几个进程都是这个进程的子进程，由它来管理和调配（比如插件进程、网络进程、渲染进程等）；同时我们看到的浏览器的整个窗口，包含地址输入栏，书签栏这些东西也都是主要进程来展示的。



#### 2、多进程

比如将键盘、鼠标分别写出两个独立的应用程序，独立运行，这就是多进程。

进程是独立的地址空间。正因为进程之间是独立的，所以在保护模式下，一个进程崩溃后，不会对其他进程产生影响，**可靠性更强**。所以，多进程适用于网络通信，分布式计算等应用场景。

但是多进程间的通信会比较麻烦，需要很多步骤，效率低。



#### 3、线程

线程与进程相似，但线程是一个比进程更小的执行单位。**一个进程在其执行的过程中可以产生多个线程**。

与进程不同的是：**同类的多个线程共享同一块内存空间和一组系统资源**，所以系统在产生一个线程，或是在各个线程之间作切换工作时，负担要比进程小得多 —— 因为不需要操作系统层面来划分新的资源。也正因为如此，线程也被称为轻量级进程。



#### 4、多线程

多线程就是**（几乎）同时**执行多个线程，多个线程可以**共享进程的内存资源，相互间切换更加快速**，支持更细粒度的任务控制，使进程中的子任务得以并发执行。

线程之间的交互的方式可以分为**互斥和同步**两种。怎么理解呢？

类比班级，在同一班级之内，同学之间通过相互的协作才能完成某些任务，有时这种协作是需要竞争的。比如学习，班级里的公共学习资料是有限的，需要竞争，当一个同学使用完了之后另一个同学才可以使用，如果一个同学正在使用，那么其他新来的同学只能等待。另一方面也需要同步协作，比如拔河比赛，同学们需要齐心协力相互配合，才能取得胜利。这就是线程交互。



#### 5、并发与并行

并发和并行是两个不同的概念。

##### 并发

并发的概念是：**在一个时间段内发生若干事件**。

对于单核 `CPU` 而言，同一时间，`CPU` 只能处理 1 个线程。多线程 "同时执行" 指的是 `CPU` 快速地在多个线程之间切换，调度线程的时间足够快，就造成了多线程的 "同时" 执行（**时间片轮转机制、分时复用**）。

如果线程数非常多，`CPU` 就会在 `n` 个线程之间切换，消耗大量的 `CPU` 资源；这时，每个线程被调度的次数就会降低，线程的执行效率也会降低。



##### 并行

并行的概念是：**在同一时刻发生若干事件**。

使用多核 `CPU` 时，可以将任务分配到不同的核同时运行，真正地实现**并行**。单核 `CPU` 是无法真正支持并行的。

可以用下面的一张图来描述**并发与并行的区别**：

<img src="https://github.com/IDeepspace/ImageHosting/raw/master/Java/java-concurrency-parallel.jpg" alt="Java 并发与并行" />

<p align="center">（图片来自 Joe Armstrong）</p>



### 二、Java 进程和线程的关系