---
title: Web 前端工程化（二） —— CI/CD（未完成）
author: Deepspace
categories: FrontEnd
date: 2019-11-05
urlname: what-is-ci-cd
tags:
  - 持续集成
  - 持续交付
  - 持续部署
---


## Web 前端工程化 —— CI/CD

工厂里的装配线以快速、自动化、可重复的方式从原材料生产出消费品。在软件开发领域，我们也同样会思考同样的问题：以快速、自动化和可重复的方式从源代码生成发布版本。 

`CI/CD` 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。`CI/CD` 的核心概念是持续集成、持续交付和持续部署。

缩略词 `CI/CD` 具有几个不同的含义。`CI/CD` 中的 `CI` 指持续集成（`Continuous Integration`），`CI/CD` 中的 `CD` 指的是持续交付（`Continuous Delivery`）或持续部署（`Continuous Deployment`）。

<!-- more -->

### 一、持续集成

持续集成（`CI`）是在源代码变更后，自动检测、拉取、构建和进行单元测试的过程。持续集成是启动管道的环节。这里的持续指的并不是 “一直在运行”，而是 “随时可运行” 的意思。

很多软件项目都有一个奇怪的问题：在软件开发过程中，应用程序在相当长的一段时间处于内不可用的状态。有了持续集成后，软件在每次修改之后都会被证明是可工作的（假如有足够全面的自动化测试集合的话）。即使它被坏了，我们也能很快知道，并且修复。



#### 准备工作

1. 版本控制

   在《持续交付》这本书中，对于持续集成中的版本控制，书中指出的好实践是：**与项目相关的所有内容都必须提交到一个版本控制库中，包括产品代码、测试代码、数据库脚本、构建与部署脚本，以及所有用于创建、安装、运行和测试该应用程序的所有东西。**把所有相关的东西放在一个版本控制库里面，有利于我们严格控制每次代码的变更都必须确保相关的代码检查和测试等工作都通过。

   但是，在我的项目实践当中发现，如果项目比较复杂，测试集合（单元测试、集成测试、UI测试、`API` 功能和性能测试等）会非常多，再加上一些其他的中间件服务（如使用 `NodeJS` 和 `Python` 写的用作系统间通讯的中间件），如果都放在一个版本控制库里面，代码库就会变得异常庞大，并且每次的代码提交如果触发所有类型的测试，那么一次持续集成过程需要的时间也会非常长（我所在的项目常常需要 `30min`）。

   如果你的项目是一个遗留系统，那么在改造整个遗留系统的过程中，也会因为某些依赖的环境或者 `Module` 的版本过于老旧且无法升级而造成开发阻碍。比如：遗留系统中依赖的 `NodeJS` 版本还是 `6.x`，并且无法快速升级，`AWS` 的 `Lambda` 服务已经放弃支持 `NodeJS 6.x` 的版本了，最终也只好新起一个版本仓库。

   所以，关于版本控制这一点，我觉得应该也需要看实际的应用场景，对非中大型、不那么复杂的项目而言，把和程序相关的东西放在一个版本控制库里，还是很有必要的。

2. 自动化构建

   

3. 团队共识



#### 持续集成的步骤



#### 持续集成的原则

1. 经常提交代码
2. 不要提交无法构建的代码
3. 立即修复无法集成的构建
4. 编写自动化的开发者测试
5. 必须通过所有测试和审查
6. 执行私有构建
7. 避免迁出无法构建的代码



### 二、持续交付

持续交付（`Continuous Delivery`）指的是，频繁地将软件的新版本，交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。



### 三、持续部署

持续部署（`Continuous Deployment`）是持续交付的下一步，指的是代码通过评审以后，自动部署到生产环境。

持续部署的目标是，代码在任何时刻都是可部署的，可以进入生产阶段。

持续部署的前提是能自动化完成测试、构建、部署等步骤。

