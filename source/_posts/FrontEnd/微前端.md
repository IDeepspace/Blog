---
title: 微前端
author: Deepspace
categories: FrontEnd
date: 2019-06-24
urlname: micro-frontends
tags:
  - 微前端
---

### 一、什么是微前端？

微前端的概念由我司(`ThoughtWorks`)在2016年十一月份的[技术雷达](https://www.thoughtworks.com/radar/techniques/micro-frontends)中被列为组织应评估的技术，后来又被提升为试用版，最后将其推广到 `Adopt` 中。

微前端是一种类似于微服务的架构。它将微服务的理念应用于浏览器端，即将单页面前端应用由单一的单体应用转变为把多个小型前端应用聚合为一的应用。各个前端应用还可以独立开发，独立部署，这样我们也就实现了应用的自治。而划分的团队之间也可以自治，独立定义自己的命名规则、代码规范、技术栈、开发流程等。

<!-- more -->

### 二、为什么需要微前端？

一个大型组织的组织架构、软件架构是在不断地发生变化的。其业务的不断发展会导致组织的应用不断地膨胀，进一步映射到软件架构上。当一个组织的部门已经过于庞大的时候，就会进一步将它细化。同理，软件的不同部分又被拆分到不同的部门之下。随着不同部门的业务发展，技术栈也会因此变得越来越难以统一，出现多样化。

而对于用户来说，会越来越厌倦同一家公司的软件出现在不同的应用上。用户厌倦之后，应用的获客成本就会变得越来越高，在这样的背景下，应用又再一次走向了聚合。最近几年，移动应用就出现了这样的趋势，我们拿支付宝来举例。

一家大的商业公司，都会提供一系列的应用，这些应用从某种程度上也可以反映这家公司的组织架构。但是在用户眼里，他们就是一家公司，他们就只应该有一个应用。就像支付宝，我们肯定希望只在一个 `App` 中进行各种操作，比如收付款、转账、理财、缴纳水电，以及现在的小程序等，当然不希望下载多个 `App` 来完成这些事情。

**相似的，这种趋势也在桌面 `Web` 出现，聚合成为客户端的一个技术趋势，实现前端聚合的就是微前端架构。**

现在，绝大多数的公司都已经采用前后端分离的架构和开发模式。分离降低了系统的复杂度，同时也提高了软件的开发效率。而随着业务的不断扩张，需求也不断扩大，应用又开始变得臃肿起来。既然应用变大了，我们就得继续拆分，拆分成更小的单元。所以，微前端的架构模式和理念也是基于此诞生。

如果你经历过一个遗留系统的项目开发，应该会有很深的体会。产品代码是使用一个老旧的前端框架搭建而成，当你想把新的框架应用到项目中的时候，却发现新技术栈的某些编译配置在当前代码库中无法使用；想在的产品代码库中构建一个响应式 `Web` 应用程序，却找不到一个合适的入口去进行代码集成。代码越来越臃肿，前进的脚步被往日堆积的技术债所阻碍。你可能会想到重写，但是对于一个遗留系统而言，在没有很清楚地弄明白它的业务细节之前，加上无法得到重写的 `support` 之前，是万万不敢轻举妄动的，也是无法进行的。**解决遗留系统，是采用微前端方案最重要的原因。**



### 三、微前端的技术拆分方式

从技术实践上来说，微前端可以采用以下几种方式进行：

1. 路由分发式。通过 `HTTP` 服务器的反向代理功能，将请求路由到对应的应用上。
2. 前端微服务化。在不同的框架之上设计通信和加载机制，以在一个页面内加载对应的应用。
3. 微应用。通过软件工程的方式，在部署构建环境之中，把多个独立的应用组合成一个单体应用。
4. 微件化。开发一个新的构建系统，将部分业务功能构建成一个独立的 `chunk` 代码，使用时只需要远程加载即可。
5. 前端容器化。将 `iframe` 作为容器来容纳其他前端应用。
6. 应用组件化。借助于 `Web Components` 技术，来构建跨框架的前端应用。

实施的方式虽然多，但都是依据场景而采用的。在某些场景下，可能没有合适的方式；而在某些场景下，则可以同时使用多种方案。下面我们看看上面这六种方式的具体实现。

#### (1) 路由分发式

路由分发式微前端，即通过路由将不同的业务分发到不同的独立前端应用上。通常是通过 `HTTP` 服务器的反向代理来实现，也可以通过应用框架自带的路由来解决。

![路由分发式](https://github.com/IDeepspace/ImageHosting/raw/master/FrontEnd/micro-frontend-router.jpg)

路由分发式的架构应该是采用最多最容易的微前端方法。但是这种方式也有一个缺点：看上去更像是多个前端应用的聚合 —— 我们只是将这些不同的前端应用拼凑在一起，使它们看起来像一个完整的整体，但它们并非是一个整体。每当用户从 `A` 应用切换到 `B` 应用的时候，往往需要刷新一下页面，重新加载资源文件。

在这个架构中，我们只需要关注应用间的数据传递方式。通常，我们只需要将当前的用户状态从 `A` 应用传递到 `B` 应用即可。如果两个应用在同一个域里运行，就更加方便了，它们可以通过 `LocalStorage` 、`Cookies` 、`IndexedDB` 等方式共享数据。

> 这里需要注意的是：在采用这种应用时，缺少了对应用状态的处理，需要用户重新登录，这种体验对用户来说相当不友好。



#### (2) 前端微服务化

前端微服务化，是微服务架构在前端的实施，每个前端应用都是完全独立的（技术栈、开发、部署、构建）、自主运行的，最后通过模块化的方式组合出完整的前端应用，架构图如下：

![前端微服务化](https://github.com/IDeepspace/ImageHosting/raw/master/FrontEnd/micro-frontend-microfrontend.jpg)

采用这种方式，就意味着一个页面上同时存在两个及以上的前端应用在运行，而前面所提到的路由分发方案则是页面页面只有唯一一个应用。

当我们单击指向某个应用的路由时，会加载、运行对应的应用。而原有的一个或多个应用，仍然可以在页面上保持运行的状态。同时，这些应用可以使用的不同的技术栈来开发，如页面上可以同时运行 `React`、`Angular` `和 Vue` 框架开发的应用。

能够这样实施的原因是：不论是基于 ` Web Components` 的 `Angular`，还是 `VirtualDOM` 的 `React`，现有的前端框架都离不开基本的 `HTML` 元素 `DOM` 。所以我们只需要做到如下两点：

- 在页面合适的地方引入或者创建 `DOM`；
- 用户操作时，加载对应的应用（触发应用的启动），并能卸载应用。

创建 `DOM` 比较容易解决，第二点却比较麻烦，特别是移除 `DOM` 和相应应用的监听。当我们拥有一个不同的技术栈时，我们需要有针对性地设计出一套这样的逻辑。同时，我们还需要保证应用间的第三方依赖之间不发生冲突。



#### (3) 组合式集成：微应用化

微应用化是指，在开发时应用都是以单一的，

#### (4) 微件化

#### (5) 前端容器：iframe

#### (6) 结合 Web Components 构建

