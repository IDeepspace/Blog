<!DOCTYPE HTML><html lang="zh-CN"><head><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="keywords" content="Web 前端工程化（二） —— CI/CD, Deepspace"><meta name="description" content="工厂的生产中，我们需要思考如何让生产线以快速、自动化和可重复的方式从原材料生产出消费品。在软件开发领域，也同样会思考同样的问题：如何以快速、自动化和可重复的方式从源代码生成发布版本。 
CI/CD 是一种通过在应用开发阶段引入自动化来频繁向"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Web 前端工程化（二） —— CI/CD | Deepspace</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><script src="/libs/jquery/jquery-2.2.0.min.js"></script><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="container"><div class="nav-wrapper"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><span></span> <span class="logo-span">Deepspace</span></a></div><a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a><ul class="right"><li class="hide-on-med-and-down"><a href="/" class="waves-effect waves-light"><i class="fa fa-home"></i> <span>首页</span></a></li><li class="hide-on-med-and-down"><a href="/tags" class="waves-effect waves-light"><i class="fa fa-tags"></i> <span>标签</span></a></li><li class="hide-on-med-and-down"><a href="/categories" class="waves-effect waves-light"><i class="fa fa-bookmark"></i> <span>分类</span></a></li><li class="hide-on-med-and-down"><a href="/archives" class="waves-effect waves-light"><i class="fa fa-archive"></i> <span>归档</span></a></li><li class="hide-on-med-and-down"><a href="/about" class="waves-effect waves-light"><i class="fa fa-user-circle-o"></i> <span>关于</span></a></li><li><a id="toggleSearch" class="waves-effect waves-light"><i id="searchIcon" class="mdi-action-search"></i></a></li></ul><div class="side-nav" id="mobile-nav"><div class="mobile-head bg-color"><div class="logo-name">Deepspace</div><div class="logo-desc"> 凡事预 ？立 ：废</div></div><ul class="menu-list mobile-menu-list"><li><a href="/" class="waves-effect waves-light"><i class="fa fa-fw fa-home"></i> 首页</a></li><li><a href="/tags" class="waves-effect waves-light"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li><a href="/categories" class="waves-effect waves-light"><i class="fa fa-fw fa-bookmark"></i> 分类</a></li><li><a href="/archives" class="waves-effect waves-light"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li><a href="/about" class="waves-effect waves-light"><i class="fa fa-fw fa-user-circle-o"></i> 关于</a></li><li><div class="divider"></div></li><li><a href="https://github.com/IDeepspace" class="waves-effect waves-light" target="_blank"><i class="fa fa-github-square fa-fw"></i> Fork Me</a></li></ul><div class="social-link"><a href="https://github.com/IDeepspace" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fa fa-github"></i></a><a href="mailto:cxin1427@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fa fa-envelope-open"></i></a><a href="#!" class="tooltipped" data-tooltip="QQ: 690862036" data-position="top" data-delay="50"><i class="fa fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fa fa-rss"></i></a></div></div></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#202020;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style> <a href="https://github.com/IDeepspace" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a></nav></header><div class="bg-cover post-cover" style="background-image:url(/medias/featureimages/lighted.jpg)"><div class="container"><div class="row"><div class="col s12 m12 l12"><div class="brand"><div class="description center-align post-detail-title"> Web 前端工程化（二） —— CI/CD</div></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1,#articleContent h2,#articleContent h3,#articleContent h4,#articleContent h5,#articleContent h6{padding-top:76px;margin-top:-76px}#articleContent h1{line-height:3.5rem}#articleContent h2{line-height:3.2rem}#articleContent h3{line-height:2.8rem}#articleContent h4{line-height:2.5rem}#articleContent h5{line-height:2.2rem}#articleContent h6{line-height:1.9rem}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px}#toc-content .is-active-link{color:#42b983}#toc-content .is-active-link::before{background-color:#42b983}</style><div class="row"><div class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="article-tag"> <a href="/tags/持续集成/" target="_blank"><span class="chip bg-color">持续集成</span></a> <a href="/tags/持续交付/" target="_blank"><span class="chip bg-color">持续交付</span></a> <a href="/tags/持续部署/" target="_blank"><span class="chip bg-color">持续部署</span></a></div><div class="post-info"><span class="post-cate"><i class="fa fa-bookmark fa-fw icon-category"></i> <a href="/categories/FrontEnd/" class="post-category" target="_blank">FrontEnd</a></span><span class="post-date"><i class="fa fa-clock-o fa-fw"></i> 2019-11-05</span></div></div><hr><div class="card-content article-card-content"><div id="articleContent"><p>工厂的生产中，我们需要思考如何让生产线以快速、自动化和可重复的方式从原材料生产出消费品。在软件开发领域，也同样会思考同样的问题：<strong>如何以快速、自动化和可重复的方式从源代码生成发布版本。</strong></p><p><code>CI/CD</code> 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。<code>CI/CD</code> 的核心概念是持续集成、持续交付和持续部署。</p><p>缩略词 <code>CI/CD</code> 具有几个不同的含义：</p><p><code>CI/CD</code> 中的 <code>CI</code> 指持续集成（<code>Continuous Integration</code>），<code>CI/CD</code> 中的 <code>CD</code> 指的是持续交付（<code>Continuous Delivery</code>）或持续部署（<code>Continuous Deployment</code>）。</p><a id="more"></a><h3 id="一、持续集成"><a href="#一、持续集成" class="headerlink" title="一、持续集成"></a>一、持续集成</h3><p>持续集成（<code>CI</code>）是在源代码变更后，<strong>自动检测、拉取、构建和进行单元测试的过程</strong>。持续集成是启动管道的环节。</p><blockquote><p>注意：这里的<strong>持续</strong>指的并不是 <strong>“一直在运行”</strong>，而是 <strong>“随时可运行”</strong> 的意思。</p></blockquote><p>有了持续集成，软件在每次修改之后都可以保证是可工作的（假如有足够全面的自动化测试集合的话），即使它被坏了，我们也能很快知道，并且修复，避免了应用程序在相当长的一段时间处于内不可用的状态。</p><p><img src="https://github.com/IDeepspace/ImageHosting/raw/master/FrontEnd/Contiunous-Integration.png" alt="Contiunous-Integration" style="zoom:50%"></p><p></p><p align="center">(图片来自网络)</p><p></p><h4 id="持续集成的优势"><a href="#持续集成的优势" class="headerlink" title="持续集成的优势"></a>持续集成的优势</h4><ul><li><p>提高开发人员的工作效率</p><p>持续集成可将开发人员从手动任务中解放出来，并且鼓励有助于减少发布到客户环境中的错误和缺陷数量的行为，从而提高团队的工作效率。</p></li><li><p>更快发现并解决缺陷</p><p>通过更频繁的测试，团队可以在一些缺陷稍后变成大问题前就发现，并解决这些缺陷。</p></li><li><p>更快地交付更新</p><p>持续集成有助于团队更快、更频繁地向客户交付更新。</p></li></ul><p>下面我们着重看下持续集成的内容，有些偏理论，但是很有用。</p><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol><li><p>版本控制</p><p>在《持续交付》这本书中，对于持续集成中的版本控制，书中指出的好实践是：<strong>与项目相关的所有内容都必须提交到一个版本控制库中，包括产品代码、测试代码、数据库脚本、构建与部署脚本，以及所有用于创建、安装、运行和测试该应用程序的东西。</strong>把所有相关的东西放在一个版本控制库里面，有利于我们严格控制每次代码的变更都必须确保相关的代码检查和测试等工作都通过。</p><p>但是，在我的项目实践当中发现，如果项目比较复杂，测试集合（单元测试、集成测试、UI测试、<code>API</code> 功能和性能测试等）会非常多，再加上一些其他的中间件服务（如使用 <code>NodeJS</code> 和 <code>Python</code> 写的用作系统间通讯的中间件），如果都放在一个版本控制库里面，代码库就会变得异常庞大，并且每次的代码提交如果触发所有类型的测试，那么一次持续集成过程需要的时间也会非常长（我所在的项目常常需要 <code>30min</code>）；并且，如果 <code>CI</code> 工具（如 <code>CIrcleCi</code>）是按照使用时长来收费，一次也会增加成本。</p><p>如果你的项目是一个遗留系统，那么在改造整个遗留系统的过程中，也会因为某些依赖的环境或者 <code>Module</code> 的版本过于老旧且无法升级而造成开发阻碍。比如：遗留系统中依赖的 <code>NodeJS</code> 版本还是 <code>6.x</code>，并且无法快速升级，<code>AWS</code> 的 <code>Lambda</code> 服务已经放弃支持 <code>NodeJS 6.x</code> 的版本了，如果想要使用一些新特性，最终也只好新起一个版本仓库。</p><p>所以，关于版本控制这一点，我觉得应该也需要看实际的应用场景，对非中大型、不那么复杂的项目而言，把和程序相关的东西放在一个版本控制库里，还是很有必要的。</p></li><li><p>自动化构建</p><p>持续集成的构建过程需要实现自动化。并且，需要满足的条件是：<strong>人和计算机都能通过命令行自动执行应用的构建、测试以及部署过程。</strong>构建脚本应该被与代码库一样同等对待，也需要有测试、重构。</p></li><li><p>团队共识</p><p>持续集成不是一种工具，而是一种实践。它需要团队开发人员遵守一些准则，达成共识。需要每个人一致认同 “<strong>修复破坏应用程序的任意修改是最高优先级的任务</strong>” 。只有大家都接受这样的准则，才能按照预期通过持续集成提高质量。</p><blockquote><p>PS：如我们团队遵循的一个准则：<strong><code>Pipline</code> 变红不能过夜</strong>，过夜就要请大家喝奶茶哦。</p></blockquote></li></ol><h4 id="持续集成包含的任务"><a href="#持续集成包含的任务" class="headerlink" title="持续集成包含的任务"></a>持续集成包含的任务</h4><p>持续集成一般执行的任务有：</p><ol><li>代码静态扫描：通过静态扫描确定代码的一些潜在 <code>bug</code>，如未被使用的变量等。</li><li>代码样式检查：团队一致定义出需要遵循的编码规范，并通过一些插件对代码进行样式合规性检查，防止不规范的代码进入版本库。比如方法名首字母小写、类的大字母大写、<code>if</code> 关键字后面需要加空格等问题都可以纳入到样式检查中。</li><li>测试：通过运行自动化的单元测试、集成测试、系统测试可以有效的保证代码的质量和程序功能的正确性。一旦有测试失败，开发人员就需要快速反应进行修复。</li><li>测试覆盖率检查：一般项目会设置一个测试覆盖率指标，如果代码达不到这样的测试覆盖率，就不会允许代码迁入。这样可以保证开发人员在新增功能时也要为新加入的功能编写自动化测试。</li><li>编译打包：确保没有任何语法错误，生成构建产出物。</li><li>发布。</li></ol><p>这些任务都必须是能通过命令行自动完成的，不同类型的项目任务略有不同。</p><h4 id="持续集成的原则"><a href="#持续集成的原则" class="headerlink" title="持续集成的原则"></a>持续集成的原则</h4><ol><li>经常提交代码</li><li>不要提交无法构建的代码</li><li>构建失败之后不要提交新代码</li><li>编写自动化测试</li><li>等提交测试通过后再继续工作</li><li>回家之前，构建必须处于成功状态</li><li>时刻准备回滚到前一个版本</li><li>在回滚之前要规定一个修复时间</li><li>不要将失败的测试注释掉</li><li>测试驱动开发</li></ol><h4 id="持续集成的工具"><a href="#持续集成的工具" class="headerlink" title="持续集成的工具"></a>持续集成的工具</h4><p>市场上有很多产品可以提供针对自动化构建和测试过程的基础设施。本质上，持续集成的软件包括两个部分：</p><ul><li><p>一个一直运行的进程，轮询版本控制系统，查看是否有新的版本提交。</p><blockquote><p>当然，你也可以做一些限制，不让持续集成软件自动运行构建脚本和测试，如过滤 <code>master</code> 分支之外的其他分支。</p></blockquote></li><li><p>提供展现这个流程运行结果的视图，通知构建的成功与否，让开发人员可以找到测试报告，通过 <code>log</code> 查看构建过程和构建失败的原因。</p></li></ul><p>常用的构建工具有：</p><ul><li><a href="http://jenkins-ci.org/" target="_blank" rel="noopener">Jenkins</a></li><li><a href="https://travis-ci.com/" target="_blank" rel="noopener">Travis</a></li><li><a href="https://circleci.com/" target="_blank" rel="noopener">CircleCI</a></li><li><a href="https://www.gocd.org/" target="_blank" rel="noopener">GoCD</a></li><li><a href="https://about.gitlab.com/product/continuous-integration/" target="_blank" rel="noopener">Gitlab CI</a></li></ul><h3 id="二、持续交付"><a href="#二、持续交付" class="headerlink" title="二、持续交付"></a>二、持续交付</h3><p>持续交付（<code>Continuous Delivery</code>）是一种软件工程的方法论。持续交付指的是频繁地将软件的新版本，交付给质量团队或者用户（或者是 <code>Product Owner</code>）。这种方式可以减少软件开发的成本与时间，减少风险。</p><h4 id="类生产环境"><a href="#类生产环境" class="headerlink" title="类生产环境"></a>类生产环境</h4><p>在持续集成的基础上，我们将集成后的代码部署到更贴近真实运行环境的 <strong>“类生产环境”</strong> 中。通常至少需要一个类生产环境。</p><p>我所在的项目中，创建了两个 “类生产环境”：<code>DEV</code> 环境（预发布环境）和 <code>Staging</code> 环境。</p><ul><li><p><code>DEV</code> 环境：用作开发自己线上测试，可以随意部署任意分支代码。</p></li><li><p><code>Staging</code> 环境：和 <code>Production</code> 环境的配置基本保持一致，用于部署比较稳定的代码版本，有时候用于测试应用程序的某一功能是否稳定。同时，<code>Staging</code> 环境也会和其他上下游的系统做集成测试，其他上下游系统的 <code>Staging</code> 环境的数据和功能也依赖于我们的 <code>Staging</code> 环境。所以，需要保证我们的 <code>Staging</code> 环境的应用程序也总是正常工作的。</p></li><li><p><code>Production</code> 环境：生产（产品）环境，直接面向于用户。应用程序在 <code>Staging</code> 环境中运行正常，没有 <code>bug</code>，可以手动部署到生产环境中。</p></li></ul><p><img src="https://github.com/IDeepspace/ImageHosting/raw/master/FrontEnd/Continuous-Delivery.png" alt="Continuous-Delivery" style="zoom:50%"></p><p></p><p align="center">(图片来自网络)</p><p></p><h3 id="三、持续部署"><a href="#三、持续部署" class="headerlink" title="三、持续部署"></a>三、持续部署</h3><p>持续部署（<code>Continuous Deployment</code>）是持续交付的下一步，是指能够自动提供持续交付管道中的应用程序版本给最终用户使用。</p><p>持续部署的前提是能自动化完成测试、构建、部署等步骤。</p><p><img src="https://github.com/IDeepspace/ImageHosting/raw/master/FrontEnd/Continuous-Deploy.png" alt="Continuous-Deploy" style="zoom:50%"></p><p></p><p align="center">(图片来自网络)</p><p></p><h4 id="和持续交付的关系"><a href="#和持续交付的关系" class="headerlink" title="和持续交付的关系"></a>和持续交付的关系</h4><p>有时候，持续交付也与持续部署混淆。持续部署意味着所有的变更都会被自动部署到生产环境中。持续交付意味着所有的变更都可以被部署到生产环境中，但是出于业务考虑，可以选择不部署。如果要实施持续部署，必须先实施持续交付。</p></div><hr><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.88rem}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{color:#fff}.reward-tabs .wechat-tab .active{color:#fff;background-color:#22ab38}.reward-tabs .alipay-tab .active{color:#fff;background-color:#019fe8}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"> <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close"><i class="fa fa-close"></i></a><h4 class="reward-title">请我喝杯咖啡?</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs"><li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li><li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li></ul><div id="wechat"> <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div><div id="alipay"> <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div></div></div></div></div></div><script>$(function(){$("#reward .reward-link").on("click",function(){$("#rewardModal").openModal()}),$("#rewardModal .close").on("click",function(){$("#rewardModal").closeModal()})})</script><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div></div><script src="/libs/share/js/social-share.min.js"></script><div class="reprint"><p> <span class="reprint-tip">转载请注明:</span> <a href="https://togoblog.cn" class="b-link-green">Deepspace</a><i class="fa fa-angle-right fa-lg fa-fw text-color"></i> <a href="/what-is-ci-cd/" class="b-link-green">Web 前端工程化（二） —— CI/CD</a></p></div></div></div><div class="article" data-aos="fade-up"><div class="card relate-article-wrapper"><header class="relate-article-header">相关文章&nbsp;<i class="fa fa-arrow-right"></i></header><div class="relate-post-box"><div class="relate-post"> <span>1、</span><a id="relate-post-link" href="/set-up-ci-env-with-circleci-and-github/">使用 CircleCI + Github 搭建持续集成环境</a></div><div class="relate-post"> <span>2、</span><a id="relate-post-link" href="/what-is-frontend-backend-separation/">Web 前端工程化（一） —— 什么是前后端分离？</a></div><div class="relate-post"> <span>3、</span><a id="relate-post-link" href="/mvc-map-mvvm/">谈谈前端开发中的 MVC、MVP、MVVM 模式</a></div><div class="relate-post"> <span>4、</span><a id="relate-post-link" href="/reflow-and-repaint/">浏览器的重排和重绘</a></div><div class="relate-post"> <span>5、</span><a id="relate-post-link" href="/micro-frontends/">微前端</a></div></div></div></div><div class="disqus-card card" data-aos="fade-up"><div id="disqus_thread" class="card-content"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div><script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'https://togoblog.cn/what-is-ci-cd/';
        this.page.identifier = '/what-is-ci-cd/';
        this.page.title = 'Web 前端工程化（二） —— CI/CD';
    };
    let disqus_shortname = 'https-togoblog-cn';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://Deepspace.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script></div></div><div class="col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title">目录</div><div id="toc-content"></div></div></div></div><script src="/libs/tocbot/tocbot.min.js"></script><script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingSelector: 'h2, h3, h4, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script></main><footer class="page-footer bg-color"><div class="container row center-align"><div class="col s12 m8 l8 copy-right"> <span>COPYRIGHT 2020 DEEPSPACE. ALL RIGHTS RESERVED.</span></div><div class="col s12 m4 l4 social-link"><a href="https://github.com/IDeepspace" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fa fa-github"></i></a><a href="mailto:cxin1427@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fa fa-envelope-open"></i></a><a href="#!" class="tooltipped" data-tooltip="QQ: 690862036" data-position="top" data-delay="50"><i class="fa fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fa fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"> <span class="title">搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input" autofocus></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script type="text/javascript">searchFunc("/search.xml","searchInput","searchResult")</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fa fa-angle-up"></i></a></div><script src="/libs/materialize/js/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script></body></html>